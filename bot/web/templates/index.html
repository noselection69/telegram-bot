<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíº –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ú–µ–Ω–µ–¥–∂–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h1 style="margin: 0;">üíº –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ú–µ–Ω–µ–¥–∂–µ—Ä</h1>
                <button id="themeToggle" class="btn" style="flex: 0 0 auto; padding: 8px 12px; background: rgba(255,255,255,0.2); border: none; color: white; cursor: pointer; border-radius: 6px; font-size: 18px;">‚òÄÔ∏è</button>
            </div>
            <div class="user-info" id="userInfo">
                <span id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </header>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="resell">üìä –ü–µ—Ä–µ–∫—É–ø–∞</button>
            <button class="tab-btn" data-tab="rental">üöó –ê—Ä–µ–Ω–¥–∞</button>
        </nav>

        <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–µ—Ä–µ–∫—É–ø–∞ -->
        <section id="resell-tab" class="tab-content active">
            <div class="section">
                <h2>üìä –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–µ—Ä–µ–∫—É–ø–∞</h2>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="showAddItemForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    <button class="btn btn-info" onclick="showInventory()">üìã –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
                    <button class="btn btn-info" onclick="showStatistics()">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                    <button class="btn btn-info" onclick="showHistory()">üìú –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂</button>
                    <button class="btn btn-info" onclick="showBuyPrices()">üí∞ –¶–µ–Ω—ã —Å–∫—É–ø–∞</button>
                </div>

                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
                <div id="addItemForm" class="form hidden">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h3>
                    <form onsubmit="submitAddItem(event)">
                        <div class="form-field">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:</label>
                            <input type="text" id="itemName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: iPhone 13" required>
                        </div>

                        <div class="form-field">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                            <select id="itemCategory" required>
                                <option value="ACCESSORY">–ê–∫—Å–µ—Å—Å—É–∞—Ä</option>
                                <option value="THING">–í–µ—â—å</option>
                                <option value="APARTMENT">–ö–≤–∞—Ä—Ç–∏—Ä–∞</option>
                                <option value="HOUSE">–î–æ–º</option>
                                <option value="CAR">–ê–≤—Ç–æ–º–æ–±–∏–ª—å</option>
                            </select>
                        </div>

                        <div class="form-field">
                            <label>–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ ($):</label>
                            <input type="number" id="itemPrice" placeholder="50000" step="0.01" required>
                        </div>

                        <div class="form-field">
                            <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                            <textarea id="itemComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">‚úÖ –î–æ–±–∞–≤–∏—Ç—å</button>
                            <button type="button" class="btn btn-secondary" onclick="hideAddItemForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
                <div id="itemsList" class="items-list">
                    <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
                </div>
                
                <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
                <div id="inventoryView" class="view hidden">
                    <h3>üìã –í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                    <div id="inventoryList" class="items-list">
                        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <button class="btn btn-secondary" onclick="hideInventory()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div id="statisticsView" class="view hidden">
                    <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    
                    <!-- –§–∏–ª—å—Ç—Ä—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ -->
                    <div style="margin-bottom: 15px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn btn-info" id="filterDay" onclick="loadStatistics('day')">üìÖ –ó–∞ –¥–µ–Ω—å</button>
                        <button class="btn btn-info" id="filterWeek" onclick="loadStatistics('week')">üìä –ó–∞ –Ω–µ–¥–µ–ª—é</button>
                        <button class="btn btn-info" id="filterAll" onclick="loadStatistics('all')" style="background: var(--accent-color);">‚è±Ô∏è –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</button>
                    </div>
                    
                    <!-- –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø—É —Å–¥–µ–ª–æ–∫ -->
                    <div style="margin-bottom: 15px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn btn-success" id="filterBest" onclick="loadStatistics(null, 'best')">üí∞ –í—ã–≥–æ–¥–Ω—ã–µ</button>
                        <button class="btn btn-danger" id="filterWorst" onclick="loadStatistics(null, 'worst')">üìâ –ù–µ–≤—ã–≥–æ–¥–Ω—ã–µ</button>
                        <button class="btn btn-secondary" id="filterNone" onclick="loadStatistics()" style="background: var(--btn-bg);">‚ú® –í—Å–µ</button>
                    </div>
                    
                    <div id="statisticsContent"></div>
                    <button class="btn btn-secondary" onclick="hideStatistics()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                
                <!-- –ò—Å—Ç–æ—Ä–∏—è -->
                <div id="historyView" class="view hidden">
                    <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂</h3>
                    <div id="historyList" class="items-list">
                        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <button class="btn btn-secondary" onclick="hideHistory()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                
                <!-- –¶–µ–Ω—ã —Å–∫—É–ø–∞ -->
                <div id="buyPricesView" class="view hidden">
                    <h3>üí∞ –¶–µ–Ω—ã —Å–∫—É–ø–∞</h3>
                    
                    <div class="form buy-price-form">
                        <h4 style="margin-bottom: 10px;">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—É</h4>
                        <div class="buy-price-inputs">
                            <input type="text" id="itemNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (5G iPhone)" class="buy-price-input" tabindex="1" style="padding: 8px; border-radius: 6px; border: 1px solid #404040; background: #2d2d2d; color: #e0e0e0;">
                            <input type="text" id="itemPriceInput" placeholder="–¶–µ–Ω–∞ (—á–∏—Å–ª–∞ –∏ –±—É–∫–≤—ã)" class="buy-price-input" tabindex="2" style="padding: 8px; border-radius: 6px; border: 1px solid #404040; background: #2d2d2d; color: #e0e0e0;">
                            <button class="btn btn-success buy-price-btn" onclick="submitBuyPrice()" tabindex="3">‚ûï</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 12px;">
                        <input type="text" id="buyPriceSearch" placeholder="–ü–æ–∏—Å–∫..." onkeyup="searchBuyPrices()" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #404040; background: #2d2d2d; color: #e0e0e0;">
                    </div>
                    
                    <div id="buyPricesList" class="items-list">
                        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <button class="btn btn-secondary" onclick="hideBuyPrices()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </section>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–æ–π -->
        <section id="rental-tab" class="tab-content">
            <div class="section">
                <h2>üöó –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–æ–π</h2>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="showAddCarForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ</button>
                    <button class="btn btn-info" onclick="showCars()">üöó –ú–æ–∏ –∞–≤—Ç–æ</button>
                    <button class="btn btn-info" onclick="showRentalStats()">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                    <button class="btn btn-info" onclick="showActiveRentals()">üîî –ê–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä–µ–Ω–¥—ã</button>
                </div>

                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ -->
                <div id="addCarForm" class="form hidden">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
                    <form onsubmit="submitAddCar(event)">
                        <div class="form-field">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ/–º–∞—Ä–∫–∞:</label>
                            <input type="text" id="carName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BMW X5" required>
                        </div>

                        <div class="form-field">
                            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –∞–≤—Ç–æ ($):</label>
                            <input type="number" id="carCost" placeholder="500000" step="0.01" required>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">‚úÖ –î–æ–±–∞–≤–∏—Ç—å</button>
                            <button type="button" class="btn btn-secondary" onclick="hideAddCarForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ -->
                <div id="carsList" class="cars-list">
                    <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π...</p>
                </div>
                
                <!-- –ú–æ–∏ –∞–≤—Ç–æ -->
                <div id="carsView" class="view hidden">
                    <h3>üöó –ú–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</h3>
                    <div id="carsList2" class="cars-list">
                        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <button class="btn btn-secondary" onclick="hideCars()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ä–µ–Ω–¥—ã -->
                <div id="rentalStatsView" class="view hidden">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ä–µ–Ω–¥—ã</h3>
                    <div id="rentalStatsContent"></div>
                    <button class="btn btn-secondary" onclick="hideRentalStats()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                
                <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä–µ–Ω–¥—ã -->
                <div id="activeRentalsView" class="view hidden">
                    <h3>üîî –ê–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä–µ–Ω–¥—ã</h3>
                    <div id="activeRentalsList" class="items-list">
                        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <button class="btn btn-secondary" onclick="hideActiveRentals()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </section>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–¥–∞—á–∏ –∞–≤—Ç–æ –≤ –∞—Ä–µ–Ω–¥—É -->
    <div id="rentalModal" class="modal hidden">
        <div class="modal-content">
            <h3>üí∞ –°–¥–∞—Ç—å –∞–≤—Ç–æ –≤ –∞—Ä–µ–Ω–¥—É</h3>
            <form onsubmit="submitRental(event)">
                <input type="hidden" id="rentalCarId">
                
                <div class="form-field">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="rentalPastToggle" onchange="toggleRentalPast()">
                        <span>üìÖ –ü—Ä–æ—à–ª–∞—è –∞—Ä–µ–Ω–¥–∞</span>
                    </label>
                </div>
                
                <div class="form-field">
                    <label>–¶–µ–Ω–∞ –∑–∞ —á–∞—Å ($):</label>
                    <input type="number" id="rentalPrice" placeholder="500" step="0.01" required>
                </div>

                <div class="form-field">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤:</label>
                    <input type="number" id="rentalHours" placeholder="4" min="1" required>
                </div>

                <div class="form-field">
                    <label id="rentalEndTimeLabel">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è (HH:MM –∏–ª–∏ +N —á–∞—Å–æ–≤):</label>
                    <input type="text" id="rentalEndTime" placeholder="22:30 –∏–ª–∏ +4" required>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-success">‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="closeRentalModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä–µ–Ω–¥—ã -->
    <div id="editRentalModal" class="modal hidden">
        <div class="modal-content">
            <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Ä–µ–Ω–¥—É</h3>
            <form onsubmit="submitEditRental(event)">
                <input type="hidden" id="editRentalId">
                
                <div class="form-field">
                    <label>–ê–≤—Ç–æ–º–æ–±–∏–ª—å:</label>
                    <input type="text" id="editRentalCar" disabled style="background-color: #f0f0f0;">
                </div>
                
                <div class="form-field">
                    <label>–¶–µ–Ω–∞ –∑–∞ —á–∞—Å ($):</label>
                    <input type="number" id="editRentalPrice" placeholder="500" step="0.01" required oninput="updateEditRentalSum()">
                </div>

                <div class="form-field">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤:</label>
                    <input type="number" id="editRentalHours" placeholder="4" min="1" required oninput="updateEditRentalSum()">
                </div>
                
                <div class="form-field">
                    <label>–ù–æ–≤–∞—è —Å—É–º–º–∞:</label>
                    <div style="font-size: 18px; font-weight: bold; padding: 10px; background-color: #f9f9f9; border-radius: 5px;">
                        <span id="editRentalNewSum">0</span>$
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-success">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditRentalModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification" class="notification hidden"></div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
