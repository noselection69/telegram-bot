#!/usr/bin/env python3
"""
–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BP –∑–∞–¥–∞–Ω–∏–π –Ω–∞ Railway
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è
- –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
- –í—Å—Ç–∞–≤–ª—è–µ—Ç 59 –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π
"""
import os
import sys

DATABASE_URL = os.environ.get('DATABASE_URL')

if not DATABASE_URL:
    print("‚ùå DATABASE_URL –Ω–µ –Ω–∞–π–¥–µ–Ω")
    sys.exit(1)

print("üîÑ –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BP –∑–∞–¥–∞–Ω–∏–π...")

try:
    from sqlalchemy import create_engine, text
    
    db_url = DATABASE_URL.replace("+asyncpg", "+psycopg2")
    if "postgresql://" in db_url and "+psycopg2" not in db_url:
        db_url = db_url.replace("postgresql://", "postgresql+psycopg2://")
    
    engine = create_engine(db_url, echo=False)
    conn = engine.connect()
    
    print("üóëÔ∏è  –®–∞–≥ 1: –£–¥–∞–ª—è—é —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è...")
    conn.execute(text("DELETE FROM bp_completions"))
    conn.commit()
    print("‚úÖ bp_completions –æ—á–∏—â–µ–Ω–∞")
    
    print("üóëÔ∏è  –®–∞–≥ 2: –£–¥–∞–ª—è—é —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è...")
    conn.execute(text("DELETE FROM bp_tasks"))
    conn.commit()
    print("‚úÖ bp_tasks –æ—á–∏—â–µ–Ω–∞")
    
    print("‚ûï –®–∞–≥ 3: –í—Å—Ç–∞–≤–ª—è—é 59 –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π...")
    
    sql = """INSERT INTO bp_tasks (name, category, bp_without_vip, bp_with_vip) VALUES
('3 —á–∞—Å–∞ –≤ –æ–Ω–ª–∞–π–Ω–µ (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –∑–∞ –¥–µ–Ω—å)', '–õ–µ–≥–∫–∏–µ', 2, 4),
('–ù—É–ª–∏ –≤ –∫–∞–∑–∏–Ω–æ', '–õ–µ–≥–∫–∏–µ', 2, 4),
('–£—Å–ø–µ—à–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ —Ç–∏—Ä–µ', '–õ–µ–≥–∫–∏–µ', 1, 2),
('–ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å –∫–∏–Ω–æ—Å—Ç—É–¥–∏—é', '–õ–µ–≥–∫–∏–µ', 2, 4),
('–ö—É–ø–∏—Ç—å –ª–æ—Ç–µ—Ä–µ–π–Ω—ã–π –±–∏–ª–µ—Ç', '–õ–µ–≥–∫–∏–µ', 1, 2),
('–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É –≤ –∫–∞–∑–∏–Ω–æ', '–õ–µ–≥–∫–∏–µ', 1, 2),
('–ó–∞–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ –æ–¥–µ–∂–¥—ã', '–õ–µ–≥–∫–∏–µ', 2, 4),
('–û—Ç–¥–∞—Ç—å –æ—Ä—É–∂–∏–µ –≤ –ø–æ–ª–∏—Ü–∏—é', '–õ–µ–≥–∫–∏–µ', 1, 2),
('–£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ –∫–∞–∑–∏–Ω–æ', '–õ–µ–≥–∫–∏–µ', 2, 4),
('–°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç', '–õ–µ–≥–∫–∏–µ', 1, 2),
('–ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç—ã –≤ —Ü–µ–Ω—Ç—Ä–µ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–î–æ—Å—Ç–∞–≤–∏—Ç—å –≥—Ä—É–∑ –≤ –ø–æ—Ä—Ç', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ –≤ –∞–≤—Ç–æ–º–∞—Å—Ç–µ—Ä—Å–∫–æ–π', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–ü–æ–≥—É–ª—è—Ç—å —Å —Å–æ–±–∞–∫–æ–π', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–ü–æ—Å–µ—Ç–∏—Ç—å –±–∞—Ä', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–ü–æ—Å–µ—Ç–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–ü–æ—Å–µ—Ç–∏—Ç—å –±–æ–ª—å–Ω–∏—Ü—É', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–ü–æ—Å–µ—Ç–∏—Ç—å –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–ü–æ—Å–µ—Ç–∏—Ç—å –Ω–æ—á–Ω–æ–π –∫–ª—É–±', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–ü–æ—Å–µ—Ç–∏—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞ –≤ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–õ–µ—á–µ–Ω–∏–µ –±–æ–ª–µ–∑–Ω–∏', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ —Ä–∞–±–æ—Ç—É', '–°—Ä–µ–¥–Ω–∏–µ', 4, 8),
('–ü–æ–ª—É—á–∏—Ç—å –ø–∏—Å—å–º–æ', '–°—Ä–µ–¥–Ω–∏–µ', 2, 4),
('–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', '–¢—è–∂–µ–ª—ã–µ', 5, 10),
('–ü–æ–±–µ–¥–∏—Ç—å –≤ –≥–æ–Ω–∫–µ', '–¢—è–∂–µ–ª—ã–µ', 5, 10),
('–£—Å–ø–µ—à–Ω–æ –∑–∞–∫–æ–Ω—á–∏—Ç—å –º–∏—Å—Å–∏—é', '–¢—è–∂–µ–ª—ã–µ', 5, 10),
('–ö—É–ø–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å', '–¢—è–∂–µ–ª—ã–µ', 7, 14),
('–ö—É–ø–∏—Ç—å –¥–æ–º', '–¢—è–∂–µ–ª—ã–µ', 10, 20),
('–ü–æ–ª—É—á–∏—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é –Ω–∞ –æ—Ä—É–∂–∏–µ', '–¢—è–∂–µ–ª—ã–µ', 6, 12),
('–°—Ç–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –±–∏–∑–Ω–µ—Å–∞', '–¢—è–∂–µ–ª—ã–µ', 8, 16),
('–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 50000 –¥–æ–ª', '–¢—è–∂–µ–ª—ã–µ', 5, 10),
('–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 100000 –¥–æ–ª', '–¢—è–∂–µ–ª—ã–µ', 7, 14),
('–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 500000 –¥–æ–ª', '–¢—è–∂–µ–ª—ã–µ', 10, 20),
('–£–±–∏—Ç—å 5 –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–æ–≤', '–¢—è–∂–µ–ª—ã–µ', 6, 12),
('–ê—Ä–µ—Å—Ç–æ–≤–∞—Ç—å 5 –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–æ–≤', '–¢—è–∂–µ–ª—ã–µ', 6, 12),
('–ü–æ–ª—É—á–∏—Ç—å –∑–≤–∞–Ω–∏–µ –º–∞–π–æ—Ä', '–¢—è–∂–µ–ª—ã–µ', 8, 16),
('–°–æ–±—Ä–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–∑ 10 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π', '–¢—è–∂–µ–ª—ã–µ', 8, 16),
('–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è', '–¢—è–∂–µ–ª—ã–µ', 15, 30),
('–í—Ä–µ–º—è –≤ –∏–≥—Ä–µ 100 —á–∞—Å–æ–≤', '–¢—è–∂–µ–ª—ã–µ', 5, 10),
('–í—Ä–µ–º—è –≤ –∏–≥—Ä–µ 500 —á–∞—Å–æ–≤', '–¢—è–∂–µ–ª—ã–µ', 10, 20),
('–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ 10 –±–æ—è—Ö', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ 50 –±–æ—è—Ö', '–¢—è–∂–µ–ª—ã–µ', 7, 14),
('–í—ã–∏–≥—Ä–∞—Ç—å 10 –±–æ–µ–≤', '–°—Ä–µ–¥–Ω–∏–µ', 4, 8),
('–í—ã–∏–≥—Ä–∞—Ç—å 50 –±–æ–µ–≤', '–¢—è–∂–µ–ª—ã–µ', 8, 16),
('–ü—Ä–æ–≤–µ—Å—Ç–∏ –º–∞—à–∏–Ω—É —á–µ—Ä–µ–∑ –≤—Å–µ –ø—Ä–æ–≤–∏–Ω—Ü–∏–∏', '–°—Ä–µ–¥–Ω–∏–µ', 4, 8),
('–ù–∞–π—Ç–∏ –≤—Å–µ —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã', '–¢—è–∂–µ–ª—ã–µ', 10, 20),
('–ù–∞–π—Ç–∏ –≤—Å–µ –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏', '–¢—è–∂–µ–ª—ã–µ', 10, 20),
('–°–æ–≤–µ—Ä—à–∏—Ç—å 1000 –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π', '–¢—è–∂–µ–ª—ã–µ', 8, 16),
('–°–ø–∞—Å—Ç–∏ 10 –∑–∞–ª–æ–∂–Ω–∏–∫–æ–≤', '–°—Ä–µ–¥–Ω–∏–µ', 4, 8),
('–ó–∞–≤–µ—Ä—à–∏—Ç—å 50 –º–∏—Å—Å–∏–π', '–¢—è–∂–µ–ª—ã–µ', 8, 16),
('–ó–∞–≤–µ—Ä—à–∏—Ç—å 100 –º–∏—Å—Å–∏–π', '–¢—è–∂–µ–ª—ã–µ', 12, 24),
('–ü–æ–ª—É—á–∏—Ç—å –∑–≤–∞–Ω–∏–µ 5 –∑–≤—ë–∑–¥ —Ä–∞–∑—ã—Å–∫', '–¢—è–∂–µ–ª—ã–µ', 6, 12),
('–ü—Ä–æ–π—Ç–∏ –æ–±—É—á–µ–Ω–∏–µ –≤ –∞–≤—Ç–æ—à–∫–æ–ª–µ', '–°—Ä–µ–¥–Ω–∏–µ', 3, 6),
('–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—ã–≥–Ω—É—Ç—å —Å —Å–∞–º–æ–ª—ë—Ç–∞', '–°—Ä–µ–¥–Ω–∏–µ', 4, 8)
"""
    
    conn.execute(text(sql))
    conn.commit()
    print("‚úÖ 59 –∑–∞–¥–∞–Ω–∏–π –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    result = conn.execute(text("SELECT COUNT(*) FROM bp_tasks")).scalar() or 0
    print(f"üìä –ò—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏–π –≤ bp_tasks: {result}")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ
    tasks = conn.execute(text("SELECT id, name, category FROM bp_tasks LIMIT 5")).fetchall()
    print("\nüìã –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–≤—ã—Ö 5 –∑–∞–¥–∞–Ω–∏–π:")
    for task in tasks:
        print(f"  - [{task[0]}] {task[1][:50]}... ({task[2]})")
    
    conn.close()
    print("\n‚úÖ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    sys.exit(0)
    
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    import traceback
    traceback.print_exc()
    sys.exit(1)
